name: Continuous Integration

# triggers on all branches and PRs
on:
  push:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2
        with:
          fetch-depth: 0
      - name: Use Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '20.11.1'

      - name: Install Dependencies
        run: npm install

      - name: Run Eslint
        run: npm run lint

      - name: Run Prettier
        run: npm run format

      - name: Run Unit Tests
        run: npm run test

      - name: test discord action
        if: success()
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
          DISCORD_EMBEDS: '[{ 
            "title": "Test"
            "author": { "name": "${{github.event.pusher.full_name}}", 
            "icon_url": "${{github.event.pusher.avatar_url}}" }, 
            "description": "${{github.event.repository.name}}",
            "timestamp": "${{ steps.current-time.outputs.time }}",
          }]'
        uses: Ilshidur/action-discord@master
        with:
          args: 'Success! Sunken-web has been successfully deployed!'
